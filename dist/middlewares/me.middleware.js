'use strict';

var _index = require('../services/index');

var _util = require('../lib/util');

var MeMiddleware;

MeMiddleware = function MeMiddleware() {
  this.accessTokenService = new _index.AccessTokenService();
  this.userService = new _index.UserService();
  this.util = new _util.Util();
};

MeMiddleware.prototype.getMe = function (req, res, next) {
  if (req.headers) {
    var accessToken = this.util.getAccessToken(req);
    if (accessToken) {
      this.userService.findMe(accessToken).then(function (user) {
        return res.send(user);
      });
    }
  } else {
    var error = this.util.unauthorizedError(res);
    res.status(401);
    return next(error);
  }
};

module.exports.MeMiddleware = MeMiddleware;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2FwcC9taWRkbGV3YXJlcy9tZS5taWRkbGV3YXJlLmpzIl0sIm5hbWVzIjpbIk1lTWlkZGxld2FyZSIsImFjY2Vzc1Rva2VuU2VydmljZSIsInVzZXJTZXJ2aWNlIiwidXRpbCIsInByb3RvdHlwZSIsImdldE1lIiwicmVxIiwicmVzIiwibmV4dCIsImhlYWRlcnMiLCJhY2Nlc3NUb2tlbiIsImdldEFjY2Vzc1Rva2VuIiwiZmluZE1lIiwidGhlbiIsInVzZXIiLCJzZW5kIiwiZXJyb3IiLCJ1bmF1dGhvcml6ZWRFcnJvciIsInN0YXR1cyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0E7O0FBRUEsSUFBSUEsWUFBSjs7QUFFQUEsZUFBZSx3QkFBWTtBQUN6QixPQUFLQyxrQkFBTCxHQUEwQiwrQkFBMUI7QUFDQSxPQUFLQyxXQUFMLEdBQW1CLHdCQUFuQjtBQUNBLE9BQUtDLElBQUwsR0FBWSxnQkFBWjtBQUNELENBSkQ7O0FBTUFILGFBQWFJLFNBQWIsQ0FBdUJDLEtBQXZCLEdBQStCLFVBQVVDLEdBQVYsRUFBZUMsR0FBZixFQUFvQkMsSUFBcEIsRUFBMEI7QUFDdkQsTUFBSUYsSUFBSUcsT0FBUixFQUFpQjtBQUNmLFFBQU1DLGNBQWMsS0FBS1AsSUFBTCxDQUFVUSxjQUFWLENBQXlCTCxHQUF6QixDQUFwQjtBQUNBLFFBQUlJLFdBQUosRUFBaUI7QUFDZixXQUFLUixXQUFMLENBQWlCVSxNQUFqQixDQUF3QkYsV0FBeEIsRUFDR0csSUFESCxDQUNRLFVBQUNDLElBQUQsRUFBVTtBQUNkLGVBQU9QLElBQUlRLElBQUosQ0FBU0QsSUFBVCxDQUFQO0FBQ0QsT0FISDtBQUlEO0FBQ0YsR0FSRCxNQVFPO0FBQ0wsUUFBTUUsUUFBUSxLQUFLYixJQUFMLENBQVVjLGlCQUFWLENBQTRCVixHQUE1QixDQUFkO0FBQ0FBLFFBQUlXLE1BQUosQ0FBVyxHQUFYO0FBQ0EsV0FBT1YsS0FBS1EsS0FBTCxDQUFQO0FBQ0Q7QUFDRixDQWREOztBQWdCQUcsT0FBT0MsT0FBUCxDQUFlcEIsWUFBZixHQUE4QkEsWUFBOUIiLCJmaWxlIjoibWUubWlkZGxld2FyZS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFjY2Vzc1Rva2VuU2VydmljZSwgVXNlclNlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9pbmRleCc7XHJcbmltcG9ydCB7IFV0aWwgfSBmcm9tICcuLi9saWIvdXRpbCc7XHJcblxyXG52YXIgTWVNaWRkbGV3YXJlO1xyXG5cclxuTWVNaWRkbGV3YXJlID0gZnVuY3Rpb24gKCkge1xyXG4gIHRoaXMuYWNjZXNzVG9rZW5TZXJ2aWNlID0gbmV3IEFjY2Vzc1Rva2VuU2VydmljZSgpO1xyXG4gIHRoaXMudXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UoKTtcclxuICB0aGlzLnV0aWwgPSBuZXcgVXRpbCgpO1xyXG59O1xyXG5cclxuTWVNaWRkbGV3YXJlLnByb3RvdHlwZS5nZXRNZSA9IGZ1bmN0aW9uIChyZXEsIHJlcywgbmV4dCkge1xyXG4gIGlmIChyZXEuaGVhZGVycykge1xyXG4gICAgY29uc3QgYWNjZXNzVG9rZW4gPSB0aGlzLnV0aWwuZ2V0QWNjZXNzVG9rZW4ocmVxKTtcclxuICAgIGlmIChhY2Nlc3NUb2tlbikge1xyXG4gICAgICB0aGlzLnVzZXJTZXJ2aWNlLmZpbmRNZShhY2Nlc3NUb2tlbilcclxuICAgICAgICAudGhlbigodXNlcikgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIHJlcy5zZW5kKHVzZXIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCBlcnJvciA9IHRoaXMudXRpbC51bmF1dGhvcml6ZWRFcnJvcihyZXMpO1xyXG4gICAgcmVzLnN0YXR1cyg0MDEpO1xyXG4gICAgcmV0dXJuIG5leHQoZXJyb3IpO1xyXG4gIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzLk1lTWlkZGxld2FyZSA9IE1lTWlkZGxld2FyZTsiXX0=