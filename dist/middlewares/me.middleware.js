'use strict';

var _index = require('../services/index');

var _util = require('../lib/util');

var MeMiddleware;

MeMiddleware = function MeMiddleware() {
  this.accessTokenService = new _index.AccessTokenService();
  this.userService = new _index.UserService();
  this.util = new _util.Util();
};

MeMiddleware.prototype.getMe = function (req, res, next) {
  if (req.headers) {
    var accessToken = this.util.getAccessToken(req);
    if (accessToken) {
      this.userService.findMe(accessToken).then(function (user) {
        res.send(user.get());
      });
    }
  } else {
    var error = this.util.unauthorizedError(res);
    return next(error);
  }
};

module.exports.MeMiddleware = MeMiddleware;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2FwcC9taWRkbGV3YXJlcy9tZS5taWRkbGV3YXJlLmpzIl0sIm5hbWVzIjpbIk1lTWlkZGxld2FyZSIsImFjY2Vzc1Rva2VuU2VydmljZSIsInVzZXJTZXJ2aWNlIiwidXRpbCIsInByb3RvdHlwZSIsImdldE1lIiwicmVxIiwicmVzIiwibmV4dCIsImhlYWRlcnMiLCJhY2Nlc3NUb2tlbiIsImdldEFjY2Vzc1Rva2VuIiwiZmluZE1lIiwidGhlbiIsInVzZXIiLCJzZW5kIiwiZ2V0IiwiZXJyb3IiLCJ1bmF1dGhvcml6ZWRFcnJvciIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7O0FBQUE7O0FBQ0E7O0FBRUEsSUFBSUEsWUFBSjs7QUFFQUEsZUFBZSx3QkFBVztBQUN4QixPQUFLQyxrQkFBTCxHQUEwQiwrQkFBMUI7QUFDQSxPQUFLQyxXQUFMLEdBQW1CLHdCQUFuQjtBQUNBLE9BQUtDLElBQUwsR0FBWSxnQkFBWjtBQUNELENBSkQ7O0FBTUFILGFBQWFJLFNBQWIsQ0FBdUJDLEtBQXZCLEdBQStCLFVBQVNDLEdBQVQsRUFBY0MsR0FBZCxFQUFtQkMsSUFBbkIsRUFBeUI7QUFDdEQsTUFBSUYsSUFBSUcsT0FBUixFQUFpQjtBQUNmLFFBQU1DLGNBQWMsS0FBS1AsSUFBTCxDQUFVUSxjQUFWLENBQXlCTCxHQUF6QixDQUFwQjtBQUNBLFFBQUlJLFdBQUosRUFBaUI7QUFDZixXQUFLUixXQUFMLENBQWlCVSxNQUFqQixDQUF3QkYsV0FBeEIsRUFDR0csSUFESCxDQUNRLFVBQUNDLElBQUQsRUFBVTtBQUNoQlAsWUFBSVEsSUFBSixDQUFTRCxLQUFLRSxHQUFMLEVBQVQ7QUFDRCxPQUhEO0FBSUQ7QUFDRixHQVJELE1BUU87QUFDTCxRQUFNQyxRQUFRLEtBQUtkLElBQUwsQ0FBVWUsaUJBQVYsQ0FBNEJYLEdBQTVCLENBQWQ7QUFDQSxXQUFPQyxLQUFLUyxLQUFMLENBQVA7QUFDRDtBQUNGLENBYkQ7O0FBZUFFLE9BQU9DLE9BQVAsQ0FBZXBCLFlBQWYsR0FBOEJBLFlBQTlCIiwiZmlsZSI6Im1lLm1pZGRsZXdhcmUuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBY2Nlc3NUb2tlblNlcnZpY2UsIFVzZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc2VydmljZXMvaW5kZXgnO1xyXG5pbXBvcnQgeyBVdGlsIH0gZnJvbSAnLi4vbGliL3V0aWwnO1xyXG5cclxudmFyIE1lTWlkZGxld2FyZTtcclxuXHJcbk1lTWlkZGxld2FyZSA9IGZ1bmN0aW9uKCkge1xyXG4gIHRoaXMuYWNjZXNzVG9rZW5TZXJ2aWNlID0gbmV3IEFjY2Vzc1Rva2VuU2VydmljZSgpO1xyXG4gIHRoaXMudXNlclNlcnZpY2UgPSBuZXcgVXNlclNlcnZpY2UoKTtcclxuICB0aGlzLnV0aWwgPSBuZXcgVXRpbCgpO1xyXG59O1xyXG5cclxuTWVNaWRkbGV3YXJlLnByb3RvdHlwZS5nZXRNZSA9IGZ1bmN0aW9uKHJlcSwgcmVzLCBuZXh0KSB7XHJcbiAgaWYgKHJlcS5oZWFkZXJzKSB7XHJcbiAgICBjb25zdCBhY2Nlc3NUb2tlbiA9IHRoaXMudXRpbC5nZXRBY2Nlc3NUb2tlbihyZXEpO1xyXG4gICAgaWYgKGFjY2Vzc1Rva2VuKSB7XHJcbiAgICAgIHRoaXMudXNlclNlcnZpY2UuZmluZE1lKGFjY2Vzc1Rva2VuKVxyXG4gICAgICAgIC50aGVuKCh1c2VyKSA9PiB7XHJcbiAgICAgICAgcmVzLnNlbmQodXNlci5nZXQoKSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBjb25zdCBlcnJvciA9IHRoaXMudXRpbC51bmF1dGhvcml6ZWRFcnJvcihyZXMpO1xyXG4gICAgcmV0dXJuIG5leHQoZXJyb3IpO1xyXG4gIH1cclxufTtcclxuXHJcbm1vZHVsZS5leHBvcnRzLk1lTWlkZGxld2FyZSA9IE1lTWlkZGxld2FyZTsiXX0=